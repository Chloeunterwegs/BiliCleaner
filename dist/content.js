(()=>{"use strict";({481:function(e,t){var o=this&&this.__awaiter||function(e,t,o,i){return new(o||(o=Promise))((function(n,r){function l(e){try{c(i.next(e))}catch(e){r(e)}}function d(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(l,d)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i="[B站评论过滤器]";let n=!0,r=!1,l=!1,d=!1,c=0,s=.03,a=[],u=[],f=[],v=[];function h(e){var t,o,n,r,l,d;const c=e.querySelector(".bili-video-card__info--tit");if(c&&v.length>0){const e=c.textContent||"";if(v.some((t=>e.includes(t))))return console.log(`${i} 标题包含白名单关键词，保留:`,{标题:e,匹配关键词:v.find((t=>e.includes(t)))}),!1}if(e.getAttribute("data-v-fb1914c6"))return!0;const s=['use[href="#palette-ad"]',".bili-video-card__info--ad",'[class*="creative-ad"]','[class*="ad-report"]','[href*="cm.bilibili.com"]'];for(const t of s)if(e.querySelector(t))return!0;const h=['use[href*="channel-movie"]','use[href*="channel-zhishi"]','use[href*="channel-zongyi"]','use[href*="channel-live"]','use[href*="channel-documentary"]','use[href*="channel-manhua"]','use[href*="channel-tv"]','[href*="bangumi"]','[href*="cheese"]','[href*="variety"]','[href*="manga.bilibili.com"]','[href*="tv.bilibili.com"]'];for(const t of h)if(e.querySelector(t))return!0;const m=e.querySelector(".badge .floor-title");if(m){const e=m.textContent||"";if(e.includes("纪录片")||e.includes("漫画")||e.includes("电视剧"))return!0}const g=[".living",'use[href*="channel-live"]','a[href*="live.bilibili.com"]','a[href*="/live/"]'];for(const t of g)if(e.querySelector(t))return!0;const y=e.querySelector(".badge");if(y&&(null===(t=y.textContent)||void 0===t?void 0:t.includes("直播")))return!0;const b=e.querySelector(".bili-video-card__info--tit");if(b&&a.length>0){const e=b.textContent||"";if(a.some((t=>e.includes(t))))return console.log(`${i} 标题包含关键词，已过滤:`,e),!0}const p=e.querySelector(".bili-video-card__info--author");if(p&&u.length>0){const e=p.textContent||"";if(u.some((t=>e.includes(t))))return console.log(`${i} 作者包含关键词，已过滤:`,e),!0}const w=e.querySelector(".bili-video-card__info--partition, .bili-video-card__info--area");if(w&&f.length>0){const t=(null===(o=w.textContent)||void 0===o?void 0:o.trim())||"",c=(null===(r=null===(n=e.querySelector(".bili-video-card__info--tit"))||void 0===n?void 0:n.textContent)||void 0===r?void 0:r.trim())||"未知标题",s=(null===(d=null===(l=e.querySelector(".bili-video-card__info--author"))||void 0===l?void 0:l.textContent)||void 0===d?void 0:d.trim())||"未知UP主";if(console.log(`${i} 视频分区检查:`,{标题:c,UP主:s,分区:t,当前过滤分区:f,是否被过滤:f.some((e=>t.includes(e)))}),f.some((e=>t.includes(e))))return console.log(`${i} 分区匹配，已过滤:`,{标题:c,UP主:s,分区:t,匹配关键词:f.find((e=>t.includes(e)))}),!0}return!1}const m=document.createElement("style");function g(e,t){let o;return(...i)=>{clearTimeout(o),o=setTimeout((()=>e(...i)),t)}}function y(e){return o(this,void 0,void 0,(function*(){try{const t=yield fetch(`https://api.bilibili.com/x/web-interface/view?bvid=${e}`),o=yield t.json();return 0===o.code?{view:o.data.stat.view,like:o.data.stat.like}:null}catch(e){return console.error("获取视频数据失败:",e),null}}))}function b(e){return o(this,void 0,void 0,(function*(){var t,o,n,r,l,d;if(e.hasAttribute("data-processed"))return;if(e.setAttribute("data-processed","true"),h(e))return void e.classList.add("filtered-video");const c=null===(t=e.querySelector('a[href*="/video/"]'))||void 0===t?void 0:t.getAttribute("href");if(!c)return void e.classList.add("filtered-video");const a=null===(o=c.match(/\/video\/(BV[\w]+)/))||void 0===o?void 0:o[1];if(!a)return void e.classList.add("filtered-video");const u=yield y(a);if(!u)return void e.classList.add("filtered-video");const f=u.like/u.view;console.log(`${i} 视频数据:`,{标题:null===(r=null===(n=e.querySelector(".bili-video-card__info--tit"))||void 0===n?void 0:n.textContent)||void 0===r?void 0:r.trim(),UP主:null===(d=null===(l=e.querySelector(".bili-video-card__info--author"))||void 0===l?void 0:l.textContent)||void 0===d?void 0:d.trim(),播放量:u.view.toLocaleString(),点赞数:u.like.toLocaleString(),点赞率:`${(100*f).toFixed(2)}%`,通过筛选:f>=s?"✅":"❌"}),f<s&&(console.log(`${i} 低于${(100*s).toFixed(1)}%，予以隐藏`),e.classList.add("filtered-video"))}))}function p(){const e=document.querySelectorAll(".bili-video-card:not(.hidden)");if(c=e.length,0===c&&!l&&!d){const e=window.innerHeight,t=document.documentElement.scrollHeight;window.scrollY+e+200>=t?(console.log(`${i} 当前页面无合格视频，触发懒加载`),function(){l=!0;const e=document.querySelector(".feed-load-anchor");if(e){const t=new IntersectionObserver((o=>{o.forEach((o=>{o.isIntersecting&&(console.log(`${i} 触发加载更多`),e.scrollIntoView(),t.disconnect(),setTimeout((()=>{document.querySelectorAll(".bili-video-card").length===c&&(console.log(`${i} 未检测到新内容加载，可能已到达底部`),d=!0),l=!1}),3e3))}))}),{root:null,rootMargin:"100px",threshold:.1});t.observe(e)}else console.log(`${i} 未找到加载触发点，可能已到达底部`),d=!0,l=!1}()):console.log(`${i} 等待用户滚动以加载更多内容`)}}function w(){if(!n)return;const e=document.querySelectorAll([".bili-video-card:not([data-filtered])",".feed-card:not([data-filtered])",".floor-card:not([data-filtered])"].join(","));if(0===e.length)return;let t=0;requestAnimationFrame((function o(){const i=Math.min(t+10,e.length);for(let o=t;o<i;o++){const t=e[o];b(t),t.setAttribute("data-filtered","true")}t=i,t<e.length?requestAnimationFrame(o):p()}))}m.textContent="\n  .recommended-swipe {\n    display: none !important;\n  }\n",document.head.appendChild(m),new Set;const L=new MutationObserver((e=>{e.forEach((e=>{"childList"===e.type&&e.addedNodes.forEach((e=>{if(e instanceof HTMLElement){if(h(e))return void e.classList.add("filtered-video");e.querySelectorAll(".bili-video-card, .floor-single-card").forEach((e=>o(void 0,void 0,void 0,(function*(){var t,o,n,r,l,d;if(!e.hasAttribute("data-processed"))if(e.setAttribute("data-processed","true"),h(e))e.classList.add("filtered-video");else if(e.classList.contains("bili-video-card")){const c=null===(t=e.querySelector('a[href*="/video/"]'))||void 0===t?void 0:t.getAttribute("href");if(!c)return void e.classList.add("filtered-video");const a=null===(o=c.match(/\/video\/(BV[\w]+)/))||void 0===o?void 0:o[1];if(!a)return void e.classList.add("filtered-video");const u=yield y(a);if(!u)return void e.classList.add("filtered-video");const f=u.like/u.view;console.log(`${i} 视频数据:`,{标题:null===(r=null===(n=e.querySelector(".bili-video-card__info--tit"))||void 0===n?void 0:n.textContent)||void 0===r?void 0:r.trim(),UP主:null===(d=null===(l=e.querySelector(".bili-video-card__info--author"))||void 0===l?void 0:l.textContent)||void 0===d?void 0:d.trim(),播放量:u.view.toLocaleString(),点赞数:u.like.toLocaleString(),点赞率:`${(100*f).toFixed(2)}%`,通过筛选:f>=s?"✅":"❌"}),f<s&&(console.log(`${i} 低于${(100*s).toFixed(1)}%，予以隐藏`),e.classList.add("filtered-video"))}}))))}}))}))}));function _(){return o(this,void 0,void 0,(function*(){if(!window.location.pathname.match(/^\/($|index.html|video|space|search)/))return void console.log(`${i} 不是目标页面，插件不工作`);console.log(`${i} 插件启动`);const{hideNav:e=!1}=yield chrome.storage.local.get("hideNav");r=e,S(r),w(),L.observe(document.body,{childList:!0,subtree:!0}),window.addEventListener("scroll",g((()=>{n&&document.querySelectorAll(".bili-video-card:not([data-processed]), .floor-single-card:not([data-processed])").forEach((e=>{e instanceof HTMLElement&&b(e)}))}),200));const{likeRatioThreshold:t=3}=yield chrome.storage.local.get("likeRatioThreshold");s=t/100;const{titleKeywords:o="",authorKeywords:l="",partitionKeywords:d="",whitelistKeywords:c=""}=yield chrome.storage.local.get(["titleKeywords","authorKeywords","partitionKeywords","whitelistKeywords"]);a=o.split(",").map((e=>e.trim())).filter((e=>e)),u=l.split(",").map((e=>e.trim())).filter((e=>e)),f=d.split(",").map((e=>e.trim())).filter((e=>e)),v=c.split(",").map((e=>e.trim())).filter((e=>e))}))}function S(e){e?document.body.classList.add("hide-nav"):document.body.classList.remove("hide-nav")}chrome.runtime.onMessage.addListener(((e,t,o)=>("TOGGLE_FILTER"===e.type&&(n=e.enabled,console.log(`${i} 过滤器状态更新:`,n),n&&w(),o({success:!0})),!0))),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",_):_(),chrome.runtime.onMessage.addListener(((e,t,o)=>{"toggleNav"===e.type&&(r=e.value,S(r),o({success:!0}))})),window.addEventListener("scroll",g((()=>{n&&p()}),200)),chrome.runtime.onMessage.addListener(((e,t,o)=>("UPDATE_LIKE_RATIO_THRESHOLD"===e.type&&(s=e.value/100,console.log(`${i} 点赞率阈值已更新: ${e.value}%`),w(),o({success:!0})),!0))),chrome.runtime.onMessage.addListener(((e,t,o)=>("UPDATE_KEYWORDS"===e.type&&("title"===e.target?(a=e.value.split(",").map((e=>e.trim())).filter((e=>e)),console.log(`${i} 标题关键词已更新:`,a)):"author"===e.target?(u=e.value.split(",").map((e=>e.trim())).filter((e=>e)),console.log(`${i} 作者关键词已更新:`,u)):"partition"===e.target?(f=e.value.split(",").map((e=>e.trim())).filter((e=>e)),console.log(`${i} 分区关键词已更新:`,f),w(),o({success:!0})):"whitelist"===e.target&&(v=e.value.split(",").map((e=>e.trim())).filter((e=>e)),console.log(`${i} 白名单关键词已更新:`,v),w(),o({success:!0}))),!0)))}})[481](0,{})})();