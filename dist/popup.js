(()=>{"use strict";({534:function(){var e=this&&this.__awaiter||function(e,t,o,i){return new(o||(o=Promise))((function(n,d){function c(e){try{r(i.next(e))}catch(e){d(e)}}function l(e){try{r(i.throw(e))}catch(e){d(e)}}function r(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(c,l)}r((i=i.apply(e,t||[])).next())}))};const t="[B站评论过滤器][Popup]";function o(){return e(this,void 0,void 0,(function*(){var t,o;const i=yield function(){return e(this,void 0,void 0,(function*(){const e=yield chrome.storage.local.get(["filterStats","filterEnabled"]);return Object.assign(Object.assign({},e.filterStats||{processedCount:0,filteredCount:0}),{isActive:!1!==e.filterEnabled})}))}(),n=document.getElementById("status"),d=document.getElementById("processedCount"),c=document.getElementById("filteredCount"),l=document.getElementById("toggleFilter");n&&(n.textContent=i.isActive?"运行中":"已停用",null===(o=null===(t=n.parentElement)||void 0===t?void 0:t.parentElement)||void 0===o||o.classList.add(i.isActive?"active":"inactive")),d&&(d.textContent=i.processedCount.toString()),c&&(c.textContent=i.filteredCount.toString()),l&&(l.checked=i.isActive)}))}let i,n;function d(e){n&&(n.textContent=e?"开启":"关闭",n.style.color=e?"#276749":"#9b2c2c")}document.addEventListener("DOMContentLoaded",(()=>e(void 0,void 0,void 0,(function*(){yield o();const c=document.getElementById("toggleFilter");c&&c.addEventListener("change",(()=>e(void 0,void 0,void 0,(function*(){yield function(o){return e(this,void 0,void 0,(function*(){var e;try{yield chrome.storage.local.set({filterEnabled:o});const i=yield chrome.tabs.query({active:!0,currentWindow:!0,url:"*://*.bilibili.com/*"});if(null===(e=i[0])||void 0===e?void 0:e.id)try{yield chrome.tabs.sendMessage(i[0].id,{type:"TOGGLE_FILTER",enabled:o})}catch(e){console.log(`${t} 页面未准备好:`,e)}}catch(e){console.error(`${t} 更新状态失败:`,e)}}))}(c.checked),yield o()})))),i=document.getElementById("toggleNav"),n=document.getElementById("hideNavStatus");const{hideNav:l=!1}=yield chrome.storage.local.get("hideNav");i&&(i.checked=l,d(l)),null==i||i.addEventListener("change",(()=>e(void 0,void 0,void 0,(function*(){const e=(null==i?void 0:i.checked)||!1;yield chrome.storage.local.set({hideNav:e}),d(e);const[t]=yield chrome.tabs.query({active:!0,currentWindow:!0});t.id&&chrome.tabs.sendMessage(t.id,{type:"toggleNav",value:e})})))),yield function(){return e(this,void 0,void 0,(function*(){const{likeRatioThreshold:o=3}=yield chrome.storage.local.get("likeRatioThreshold"),i=document.getElementById("likeRatioThreshold");i&&(i.value=o.toString());const n=document.getElementById("saveLikeRatio");n&&n.addEventListener("click",(()=>e(this,void 0,void 0,(function*(){var e;const o=parseFloat(i.value);if(isNaN(o)||o<0||o>100)return void alert("请输入0-100之间的有效数值");yield chrome.storage.local.set({likeRatioThreshold:o});const n=yield chrome.tabs.query({active:!0,currentWindow:!0,url:"*://*.bilibili.com/*"});if(null===(e=n[0])||void 0===e?void 0:e.id)try{yield chrome.tabs.sendMessage(n[0].id,{type:"UPDATE_LIKE_RATIO_THRESHOLD",value:o})}catch(e){console.log(`${t} 页面未准备好:`,e)}}))))}))}(),yield function(){return e(this,void 0,void 0,(function*(){const{titleKeywords:o="",authorKeywords:i=""}=yield chrome.storage.local.get(["titleKeywords","authorKeywords"]),n=document.getElementById("titleKeywords"),d=document.getElementById("authorKeywords");n&&(n.value=o),d&&(d.value=i);const c=document.getElementById("saveTitleKeywords");c&&c.addEventListener("click",(()=>e(this,void 0,void 0,(function*(){var e;const o=n.value.trim();yield chrome.storage.local.set({titleKeywords:o});const i=yield chrome.tabs.query({active:!0,currentWindow:!0,url:"*://*.bilibili.com/*"});if(null===(e=i[0])||void 0===e?void 0:e.id)try{yield chrome.tabs.sendMessage(i[0].id,{type:"UPDATE_KEYWORDS",target:"title",value:o})}catch(e){console.log(`${t} 页面未准备好:`,e)}}))));const l=document.getElementById("saveAuthorKeywords");l&&l.addEventListener("click",(()=>e(this,void 0,void 0,(function*(){var e;const o=d.value.trim();yield chrome.storage.local.set({authorKeywords:o});const i=yield chrome.tabs.query({active:!0,currentWindow:!0,url:"*://*.bilibili.com/*"});if(null===(e=i[0])||void 0===e?void 0:e.id)try{yield chrome.tabs.sendMessage(i[0].id,{type:"UPDATE_KEYWORDS",target:"author",value:o})}catch(e){console.log(`${t} 页面未准备好:`,e)}}))))}))}()}))))}})[534]()})();