(()=>{"use strict";({534:function(){var e=this&&this.__awaiter||function(e,t,o,i){return new(o||(o=Promise))((function(n,l){function r(e){try{c(i.next(e))}catch(e){l(e)}}function d(e){try{c(i.throw(e))}catch(e){l(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(r,d)}c((i=i.apply(e,t||[])).next())}))};const t="[B站评论过滤器][Popup]";function o(){return e(this,void 0,void 0,(function*(){var t,o;const i=yield function(){return e(this,void 0,void 0,(function*(){const e=yield chrome.storage.local.get(["filterStats","filterEnabled"]);return Object.assign(Object.assign({},e.filterStats||{processedCount:0,filteredCount:0}),{isActive:!1!==e.filterEnabled})}))}(),n=document.getElementById("status"),l=document.getElementById("processedCount"),r=document.getElementById("filteredCount"),d=document.getElementById("toggleFilter");n&&(n.textContent=i.isActive?"运行中":"已停用",null===(o=null===(t=n.parentElement)||void 0===t?void 0:t.parentElement)||void 0===o||o.classList.add(i.isActive?"active":"inactive")),l&&(l.textContent=i.processedCount.toString()),r&&(r.textContent=i.filteredCount.toString()),d&&(d.checked=i.isActive)}))}let i,n;function l(e){n&&(n.textContent=e?"开启":"关闭",n.style.color=e?"#276749":"#9b2c2c")}function r(){const e=document.createElement("div");e.className="save-success",e.textContent="保存成功",document.body.appendChild(e),setTimeout((()=>{e.remove()}),2e3)}function d(o,i,n){var l;const d=document.createElement("div");d.className="keyword-tag",d.innerHTML=`\n    ${o}\n    <span class="remove">×</span>\n  `,null===(l=d.querySelector(".remove"))||void 0===l||l.addEventListener("click",(()=>e(this,void 0,void 0,(function*(){var e;d.remove();const o=Array.from(i.querySelectorAll(".keyword-tag")).map((e=>{var t;return null===(t=e.textContent)||void 0===t?void 0:t.replace("×","").trim()})).filter(Boolean).join(",");yield chrome.storage.local.set({[`${n}Keywords`]:o});const l=yield chrome.tabs.query({active:!0,currentWindow:!0,url:"*://*.bilibili.com/*"});if(null===(e=l[0])||void 0===e?void 0:e.id)try{yield chrome.tabs.sendMessage(l[0].id,{type:"UPDATE_KEYWORDS",target:n,value:o}),r()}catch(e){console.log(`${t} 页面未准备好:`,e)}})))),i.appendChild(d)}function c(o,i,n){o.addEventListener("keypress",(l=>e(this,void 0,void 0,(function*(){var e;if("Enter"===l.key){l.preventDefault();const c=o.value.trim();if(c){d(c,i,n),o.value="";const l=Array.from(i.querySelectorAll(".keyword-tag")).map((e=>{var t;return null===(t=e.textContent)||void 0===t?void 0:t.replace("×","").trim()})).filter(Boolean).join(",");yield chrome.storage.local.set({[`${n}Keywords`]:l});const s=yield chrome.tabs.query({active:!0,currentWindow:!0,url:"*://*.bilibili.com/*"});if(null===(e=s[0])||void 0===e?void 0:e.id)try{yield chrome.tabs.sendMessage(s[0].id,{type:"UPDATE_KEYWORDS",target:n,value:l}),r()}catch(e){console.log(`${t} 页面未准备好:`,e)}}}}))))}function s(e){const t=document.getElementById("hotReplyStatus");t&&(t.textContent=e?"开启":"关闭",t.style.color=e?"#276749":"#9b2c2c")}document.addEventListener("DOMContentLoaded",(()=>e(void 0,void 0,void 0,(function*(){yield o();const a=document.getElementById("toggleFilter");a&&a.addEventListener("change",(()=>e(void 0,void 0,void 0,(function*(){yield function(o){return e(this,void 0,void 0,(function*(){var e;try{yield chrome.storage.local.set({filterEnabled:o});const i=yield chrome.tabs.query({active:!0,currentWindow:!0,url:"*://*.bilibili.com/*"});if(null===(e=i[0])||void 0===e?void 0:e.id)try{yield chrome.tabs.sendMessage(i[0].id,{type:"TOGGLE_FILTER",enabled:o})}catch(e){console.log(`${t} 页面未准备好:`,e)}}catch(e){console.error(`${t} 更新状态失败:`,e)}}))}(a.checked),yield o()})))),i=document.getElementById("toggleNav"),n=document.getElementById("hideNavStatus");const{hideNav:u=!1}=yield chrome.storage.local.get("hideNav");i&&(i.checked=u,l(u)),null==i||i.addEventListener("change",(()=>e(void 0,void 0,void 0,(function*(){const e=(null==i?void 0:i.checked)||!1;yield chrome.storage.local.set({hideNav:e}),l(e);const[t]=yield chrome.tabs.query({active:!0,currentWindow:!0});t.id&&chrome.tabs.sendMessage(t.id,{type:"toggleNav",value:e})})))),yield function(){return e(this,void 0,void 0,(function*(){const{likeRatioThreshold:o=3}=yield chrome.storage.local.get("likeRatioThreshold"),i=document.getElementById("likeRatioThreshold");i&&(i.value=o.toString());const n=document.getElementById("saveLikeRatio");n&&n.addEventListener("click",(()=>e(this,void 0,void 0,(function*(){var e;const o=parseFloat(i.value);if(isNaN(o)||o<0||o>100)return void alert("请输入0-100之间的有效数值");yield chrome.storage.local.set({likeRatioThreshold:o});const n=yield chrome.tabs.query({active:!0,currentWindow:!0,url:"*://*.bilibili.com/*"});if(null===(e=n[0])||void 0===e?void 0:e.id)try{yield chrome.tabs.sendMessage(n[0].id,{type:"UPDATE_LIKE_RATIO_THRESHOLD",value:o})}catch(e){console.log(`${t} 页面未准备好:`,e)}}))))}))}(),yield function(){return e(this,void 0,void 0,(function*(){const{titleKeywords:e="",authorKeywords:t="",partitionKeywords:o="",whitelistKeywords:i=""}=yield chrome.storage.local.get(["titleKeywords","authorKeywords","partitionKeywords","whitelistKeywords"]),n=document.getElementById("titleKeywords"),l=document.getElementById("titleTags");n&&l&&(e.split(",").filter((e=>e.trim())).forEach((e=>d(e.trim(),l,"title"))),c(n,l,"title"));const r=document.getElementById("authorKeywords"),s=document.getElementById("authorTags");r&&s&&(t.split(",").filter((e=>e.trim())).forEach((e=>d(e.trim(),s,"author"))),c(r,s,"author"));const a=document.getElementById("partitionKeywords"),u=document.getElementById("partitionTags");a&&u&&(o.split(",").filter((e=>e.trim())).forEach((e=>d(e.trim(),u,"partition"))),c(a,u,"partition"));const v=document.getElementById("whitelistKeywords"),y=document.getElementById("whitelistTags");v&&y&&(i.split(",").filter((e=>e.trim())).forEach((e=>d(e.trim(),y,"whitelist"))),c(v,y,"whitelist"))}))}(),yield function(){return e(this,void 0,void 0,(function*(){const{replyRatioThreshold:t=1}=yield chrome.storage.local.get("replyRatioThreshold"),o=document.getElementById("replyRatioThreshold");o&&(o.value=t.toString());const{enableHotReply:i=!1}=yield chrome.storage.local.get("enableHotReply"),n=document.getElementById("toggleHotReply");document.getElementById("hotReplyStatus"),n&&(n.checked=i,s(i));const l=document.getElementById("saveReplyRatio");l&&l.addEventListener("click",(()=>e(this,void 0,void 0,(function*(){var e;const t=parseFloat(o.value);if(isNaN(t)||t<0||t>100)return void alert("请输入0-100之间的有效数值");yield chrome.storage.local.set({replyRatioThreshold:t});const i=yield chrome.tabs.query({active:!0,currentWindow:!0,url:"*://*.bilibili.com/*"});(null===(e=i[0])||void 0===e?void 0:e.id)&&chrome.tabs.sendMessage(i[0].id,{type:"UPDATE_REPLY_RATIO_THRESHOLD",value:t}),r()})))),null==n||n.addEventListener("change",(()=>e(this,void 0,void 0,(function*(){var e;const t=n.checked;yield chrome.storage.local.set({enableHotReply:t}),s(t);const o=yield chrome.tabs.query({active:!0,currentWindow:!0,url:"*://*.bilibili.com/*"});(null===(e=o[0])||void 0===e?void 0:e.id)&&chrome.tabs.sendMessage(o[0].id,{type:"TOGGLE_HOT_REPLY",enabled:t})}))))}))}()}))))}})[534]()})();